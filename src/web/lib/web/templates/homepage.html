{% extends "main.html" %}
{%- import '_macros.html' as macros with context -%}

{%- block title %}
    Reporty - VA2AM
{%- endblock %}

{%- block content %}
    <div class="m-3">
        <div class="d-flex align-items-start">
            <h3 class="text-primary mb-1 fw-bolder">
                CESNET reporty o zranitelnostech
            </h3>
            <a href="{{ url_for('reports.feed') }}"
               class="d-flex align-items-center ms-auto text-dark fw-normal h5 text-decoration-none">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-rss" viewBox="0 0 16 16">
                    <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z" />
                    <path d="M5.5 12a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0m-3-8.5a1 1 0 0 1 1-1c5.523 0 10 4.477 10 10a1 1 0 1 1-2 0 8 8 0 0 0-8-8 1 1 0 0 1-1-1m0 4a1 1 0 0 1 1-1 6 6 0 0 1 6 6 1 1 0 1 1-2 0 4 4 0 0 0-4-4 1 1 0 0 1-1-1" />
                </svg>
                <p class="m-0 ms-1">
                    RSS
                </p>
            </a>
        </div>
        <p class="m-0 mb-2">
            Tato služba je blíže popsána na webu
            <a href="https://csirt.cesnet.cz/cs/services/vamp" target="_blank">CESNET-CERTS</a>.
        </p>
        {{ macros.CESNET_services_warning(warning_seen) }}
        <form class="input-group search-form my-2">
            <input type="text"
                   name="search"
                   value="{{ search_arg or '' }}"
                   class="form-control text-field"
                   onfocus="this.style.boxShadow='none';">
            <button type="submit" class="btn btn-secondary btn-sm">
                Vyhledat
            </button>
        </form>
        {% if reports %}
            <div class="list-group border border-dark">
                {% for report in reports %}
                    <a class="list-group-item d-flex m-0"
                       href="{{ url_for('reports.show', report_id=report.get_id()) }}">
                        <p class="me-3 ms-1 my-auto text-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-box-arrow-up-right" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5" />
                                <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0z" />
                            </svg>
                        </p>
                        <div class="d-flex flex-column w-100">
                            <div class="d-flex flex-column flex-md-row mt-1">
                                <h5 class="m-0 me-2 mb-1">
                                    {{ report.get_formatted_tlp() }} {{ report.get_title() }}
                                </h5>
                                {% if report.get_max_cvss_number() %}
                                    <h5 class="m-0 fw-normal mb-1">
                                        <span class="badge bg-primary rounded-pill">
                                            CVSS {{ report.get_max_cvss_number() }}
                                            ({{ get_cvss_severity(report.get_max_cvss_number()) }})
                                        </span>
                                    </h5>
                                {% endif %}
                            </div>
                            {%- if report.get_publish_date() %}
                                <div class="text-secondary me-4 mb-1">
                                    {{ translate(report, 'published') }}
                                    {{ translate(report, 'on_day') }}
                                    {{ report.get_publish_date() }}.
                                </div>
                            {%- endif %}
                        </div>
                    </a>
                {% endfor %}
            </div>
        {% else %}
            <div class="alert alert-warning d-flex align-items-center mt-3" role="alert">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-exclamation-triangle-fill flex-shrink-0 me-2" viewBox="0 0 16 16" role="img" aria-label="Warning:">
                    <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5zm.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2z" />
                </svg>
                <p class="m-0">
                    {% if search_arg %}
                        Pod tímto klíčovým slovem nebyly nalezeny žádné reporty. Můžete se vrátit
                        na <a href="{{ url_for('reports.home') }}">domovskou stránku</a>.
                    {% else %}
                        Nebyly nalezeny žádné reporty.
                    {% endif %}
                </p>
            </div>
        {% endif %}
        <div class="d-flex mt-3 justify-content-center">
            {% if reports -%}
                <nav aria-label="Page navigation example">
                    <ul class="pagination">
                        <li class="page-item {{ 'disabled' if page == 1 else '' }}">
                            <a class="page-link" href="{{ build_url(1) }}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-double-left" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M8.354 1.646a.5.5 0 0 1 0 .708L2.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0" />
                                    <path fill-rule="evenodd" d="M12.354 1.646a.5.5 0 0 1 0 .708L6.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0" />
                                </svg>
                            </a>
                        </li>
                        {% for i in range([1, page-2]|max, [page+3, pages+1]|min) %}
                            <li class="page-item {{ 'active' if i == page else '' }}">
                                <a class="page-link" href="{{ build_url(i) }}">{{ i }}</a>
                            </li>
                        {% endfor %}
                        <li class="page-item {{ 'disabled' if page == pages else '' }}">
                            <a class="page-link" href="{{ build_url(pages) }}">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-double-right" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M3.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L9.293 8 3.646 2.354a.5.5 0 0 1 0-.708" />
                                    <path fill-rule="evenodd" d="M7.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L13.293 8 7.646 2.354a.5.5 0 0 1 0-.708" />
                                </svg>
                            </a>
                        </li>
                    </ul>
                </nav>
            {%- endif %}
            <div class="d-none d-md-flex flex-row ms-auto">
                <a href="https://csirt.cesnet.cz/cs/index"
                   target="_blank"
                   class="ms-auto">
                    <img src="{{ url_for('static', filename='logo.svg') }}"
                         height="45"
                         width="90"
                         alt="CESNET CERTS Logo">
                </a>
            </div>
        </div>
    </div>
{%- endblock %}

{% macro build_url(new_page) -%}
    /{{ '?search=' + search_arg + '&' if search_arg else '?' }}page={{ new_page }}
{%- endmacro %}
